---
layout: single
title: "69일차-스프링부트(6)-BoardProject"
---

# BoardProject
## 조회수 처리
### BoardService.java
다음 코드를 추가

```java
boardRepository.boardHits(id);
```

### BoardRepository.java
다음 코드를 추가

```java
// native sql: update board_table set boardHits = boardHits + 1 where id=?
// jpql(java persistence query language): 스프링에서 지원해주는 native query
// 변수명은 entity의 변수명 기준(entity를 타고 가기 때문)
// 별칭(b)을 반드시 지정
@Modifying
@Query(value = "update BoardEntity b set b.boardHits = b.boardHits + 1 where b.id = :id")
void boardHits(@Param("id") Long id);
```

## 수정/삭제
### detail.html
매개변수 활용 방법   
`<body>`

```html
<button onclick="req(1)">글삭제</button>
<button onclick="req(2)">글수정</button>
<p id="inputPosition"></p>
```

```js
<script th:inline="javascript">
    const req = (num) => {
        let inputTag = "<input type=\"text\" placeholder=\"비밀번호\" id=\"pwInput\"><button type=\"button\" id=\"password\" onclick=\"pwCheck2(" + num + ")\">확인</button>";
        document.getElementById("inputPosition").innerHTML = inputTag;
    }
    const pwCheck2 = (num) => {
        console.log(num);
        const pw = [[${board.boardPassword}]];
        console.log(pw);
        const boardId = [[${board.id}]];
        console.log(boardId);
        const inputPassword = document.getElementById("pwInput").value
        if (inputPassword == pw)
            if (num == 1)
                location.href = "/board/delete/" + boardId;
            else
                location.href = "/board/update/" + boardId;
        else
            alert("비밀번호 불일치")
    }
</script>
```

## 페이징
### BoardController.java

```java
// /board?page=1
// /board/3/1: 3페이지 1번글
// rest api: 주소값만으로 자원을 식별(지금까지 하던거, /board/10) 
// Pageable: 페이지와 관련된 인터페이스
@GetMapping
public String paging(@PageableDefault(page = 1) Pageable pageable, Model model) {
    Page<BoardDTO> boardList = boardService.paging(pageable);
    model.addAttribute("boardList", boardList);
    ...
}
```
>변수 `pageable`에 담긴 페이지 값을 매개변수로 넘김

### BoardService.java

```java
public Page<BoardDTO> paging(Pageable pageable) {
    int page = pageable.getPageNumber(); // 요청 페이지값 가져옴
    // 요청한 페이지가 1이면 페이지값을 0으로 하고 1이 아니면 요청 페이지에서 1을 뺀다.
//        page = page - 1;
    page = (page == 1)? 0: (page-1); // 삼항연산자
    // PageRequest: 매서드 오버로딩
    Page<BoardEntity> boardEntities = boardRepository.findAll(PageRequest.of(page, PagingConst.PAGE_LIMIT, Sort.by(Sort.Direction.DESC, "id")));
    // "id" 부분은 카멜케이스로 써야함.
    // Page<BoardEntity> => Page<BoardDTO>
    // map: page객체가 제공하는 변환 메서드, 자동으로 옮겨담아줌
    Page<BoardDTO> boardList = boardEntities.map(
            // BoardEntity 객체 -> BoardDTO 객체 변환
            // board: BoardEntity 객체
            // new BoardDTO() 생성자 호출
            board -> new BoardDTO(board.getId(), // 화살표 함수는 변수(board)만 써줘도 인식 됨
                    board.getBoardTitle(),
                    board.getBoardWriter(),
                    board.getBoardHits(),
                    board.getCreatedTime()
            ));
    return boardList;
}
```
>Creates a new {@link PageRequest} with sort parameters applied.   
>@param page - zero-based page index.   
>@param size - the size of the page to be returned.   
>@param sort - must not be {@literal null}, use {@link Sort#unsorted()} instead.   
>```java
>public static PageRequest of(int page, int >size, Sort sort) {
>    return new PageRequest(page, size, sort);
>	}
>```
>DB에서 

#### 오버로딩 & 오버라이딩
- 오버로딩(Overloading) : 같은 이름의 메서드 여러개를 가지면서 매개변수의 유형과 개수가 다르도록 하는 기술
- 오버라이딩(Overriding) : 상위 클래스가 가지고 있는 메서드를 하위 클래스가 재정의해서 사용