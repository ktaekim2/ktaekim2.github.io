---
layout: single
title: "65일차 배운 내용 정리-스프링부트(2)"
---

<img src="..\assets\images\2022-06-20-1647.excalidraw.svg">

## 실습-save

### TestController.java

### TestDTO.java

```java
@Data
public class TestDTO {
    private Long id;
    private String column1;
    private String testColumn2;
}
```

```java
@Controller
@RequiredArgsConstructor
public class TestController {
    private final TestService testService;

    @GetMapping("/")
    public String index() {
        return "index";
    }

    @GetMapping("/save-form")
    public String saveForm() {
        return "save";
    }

    @PostMapping("/save")
    public String save(@ModelAttribute TestDTO testDTO) {
        testService.save(testDTO);
        return "index";
    }
}
```

### save.html

```html
<form action="/save" method="post">
    <input type="text" name="column1"><br> <!-- setColumn1() 자동으로 찾아서 담음-->
    <input type="text" name="testColumn2"><br> <!-- setTestColumn2()-->
    <input type="submit" value="저장"><br>
</form>
```

### TestService.java

```java
@Service
@RequiredArgsConstructor
public class TestService {
    private final TestRepository testRepository;

    public Long save(TestDTO testDTO) {
        System.out.println("testDTO = " + testDTO);

        // testDTO 객체에 담긴 값을 TestEntity 객체에 옮겨담기
        TestEntity testEntity1 = TestEntity.toEntity(testDTO);
        Long id = testRepository.save(testEntity1).getId();
        return id;
    }
}
```

### TestRepository.java

```java
public interface TestRepository extends JpaRepository<TestEntity, Long> {
}
```

## 실습-테스트코드

### TestDTO.java

```java
@NoArgsConstructor
@Data
public class TestDTO {
    private Long id;
    private String column1;
    private String testColumn2;

    // 테스트코드를 위해 필드값을 쉽게 저장하기 위해서
    // alt + insert -> constructor
    public TestDTO(String column1, String testColumn2) { 
        this.column1 = column1;
        this.testColumn2 = testColumn2;
    }

    public static TestDTO toDTO(TestEntity testEntity) {
        TestDTO testDTO = new TestDTO();
        testDTO.setId(testEntity.getId());
        testDTO.setColumn1(testEntity.getColumn1());
        testDTO.setTestColumn2(testEntity.getTestColumn2());
        return testDTO;
    }
}
```

### TestClass.java

```java
// 테스트를 위해 제공되는 class(Junit)
import static org.assertj.core.api.Assertions.*;

@SpringBootTest
public class TestClass {
    @Autowired
    private TestService testService;
    @Test
    public void saveTest() {
        /**
         1. 저장할 TestDTO 객체를 만들고 필드값을 저장.
         2. DTO 객체를 서비스의 save 메서드로 전달
         3. 전달 후 리턴 값을 받아서(Long)
         4. 그 리턴값으로 DB에서 findById를 하고
         5. DB에서 조회된 데이터의 1.번에서 저장한 데이터가 일치하는지를 판단하여
         6. 일치하면 테스트 통과, 일치하지 않으면 테스트 실패
         */
        // 1.
        TestDTO testDTO = new TestDTO("테스트데이터1", "테스트데이터2");
        // 2. 3.
        Long saveId = testService.save(testDTO);
        // 4.
        TestDTO findDTO = testService.findById(saveId);
        // 5. 6.
        // static 을 붙이고 import 를 하면 앞에 Assertions. 을 생략 가능
        assertThat(testDTO.getColumn1()).isEqualTo(findDTO.getColumn1());
    }
}
```

### TestService.java

```java
public TestDTO findById(Long id) {
    Optional<TestEntity> optionalTestEntity = testRepository.findById(id);
    // findById 하면 Optional 객체로 감싸줌: nullpointexception 방지
    if(optionalTestEntity.isPresent()) {
        // isPresent() 메서드: 있니? -> true: 있다, isEmpty(): 비었니? -> true: 비었다
        // 조회된 결과가 있다
        TestEntity testEntity = optionalTestEntity.get(); // get(): Optional 감싸져 있는걸 까는 것
        TestDTO testDTO = TestDTO.toDTO(testEntity);
        return testDTO;
        // return TestDTO.toDTO(optionalTestEntity.get());
    } else {
        // 조회된 결과가 없다
        return null;
    }
}
```

<img src="..\assets\images\2022-06-21-1233.excalidraw.svg">


 
