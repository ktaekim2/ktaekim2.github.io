---
layout: single
title: "45일차 배운 내용 정리-Spring Framework(5)-Member Project(2)"
---

# Member Project

|주소값|http method|역할|
|---|---|---|
|/|get|시작페이지|
|/save-form|get|회원가입 페이지 출력|
|/save|post|회원가입 처리|
|/login-form|get|로그인 페이지 출력|
|/login|post|로그인 처리|
|/findAll|get|회원목록 출력|

## 추가된 기능

|주소값|http method|역할|
|---|---|---|
|/detail|get|조회 페이지 출력|
|/delete|get|삭제 처리|
|/update-form|get|회원정보 수정 페이지 출력|
|/update|post|회원정보 수정 처리|
|/duplicate-check|post|아이디 중복 처리|
|/response-test|get|responseTest|
|/response-test2|get|responseTest2|
|/detail-ajax|get|list페이지에 ajax 적용|
|/logout|get|로그아웃 처리|

## 조회
### list.jsp
에서 조회 페이지로 이동
```jsp
<a href="/detail?id=${member.id}">조회</a>
```

### MemberController.java
```java
@GetMapping("/detail")
public String findById(@RequestParam("id") Long id, Model model) {
    MemberDTO memberDTO = memberService.findById(id);
    model.addAttribute("member", memberDTO);
    return "detail";
}
```

### detail.jsp
```jsp
조회 결과: ${member}
```

## 삭제
### list.jsp
에서 삭제 페이지로 이동
```jsp
<a href="/delete?id=${member.id}">삭제</a>
```

### MemberController.java
```java
@GetMapping("/delete")
public String deleteById(@RequestParam("id") Long id) {
    boolean deleteResult = memberService.deleteById(id);
    if (deleteResult) {
        return "redirect:/findAll";
    } else {
        return "delete-fail";
    }
}
```
>redirect: 컨트롤러의 메서드에서 다른 메서드의 주소를 호출. controller내부에서 다른 메소드 실행을 위해 사용.

### MemberService.java
```java
public boolean deleteById(Long id) {
    int deleteResult = memberRepository.deleteById(id);
    if (deleteResult > 0) {
        return true;
    } else {
        return false;
    }
}
```

### MemberRepository.java
```java
public int deleteById(Long id) {
    return sql.delete("Member.deleteById", id);
}
```

### dataMapper.xml
```xml
<delete id="deleteById" parameterType="Long">
    delete
    from member_table
    where id = #{id}
</delete>
```

## 회원정보 수정
로그인 성공시 main.jsp로 이동하게 됨.  
main.jsp에서 회원정보 수정 페이지로 이동.
### main.jsp
```jsp
<body>
<button class="btn btn-primary" onclick="location.href='/update-form'">수정</button>
<button class="btn btn-danger" onclick="updateForm()">수정(함수호출)</button>
</body>
<script>
    function updateForm() {
        location.href = '/update-form';
    }
</script>
```
>두 가지 방법 모두 유효

### MemberService.java
```java
@GetMapping("/update-form")
public String updateForm(HttpSession session, Model model) {
    // 로그인을 한 상태기 때문에 세션에 id, memberId가 들어있고
    // 여기서 세션에 있는 id를 가져온다.
    Long updateId = (Long) session.getAttribute("loginId");
    System.out.println("updateId = " + updateId); // soutv
    // DB에서 해당 회원의 정보를 가져와서 그 정보를 가지고 update.jsp로 이동
    MemberDTO memberDTO = memberService.findById(updateId);
    model.addAttribute("updateMember", memberDTO);
    return "update";
}
```
### ajax
비동기 방식: 화면이 바뀌지 않고 서버와 정보를 주고받는 것
